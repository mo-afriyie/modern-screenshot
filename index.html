<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Modern Screenshot - HTML Export Demo</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body,
      html {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: #f5f5f5;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
      }

      .header h1 {
        color: #333;
        margin-bottom: 10px;
      }

      .header p {
        color: #666;
        font-size: 16px;
      }

      .demo-section {
        background: white;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .content-to-capture {
        border: 2px dashed #e0e0e0;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        text-align: center;
      }

      .content-to-capture h2 {
        margin: 0 0 15px 0;
        font-size: 24px;
      }

      .content-to-capture p {
        margin: 0 0 20px 0;
        opacity: 0.9;
      }

      .sample-image {
        width: 300px;
        height: 200px;
        object-fit: cover;
        border-radius: 8px;
        margin: 10px 0;
      }

      .controls {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 20px;
      }

      .btn {
        background: #4caf50;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
        min-width: 140px;
      }

      .btn:hover {
        background: #45a049;
        transform: translateY(-1px);
      }

      .btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      .btn.secondary {
        background: #2196f3;
      }

      .btn.secondary:hover {
        background: #1976d2;
      }

      .output {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        padding: 15px;
        margin-top: 20px;
        font-family: "Monaco", "Menlo", monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
      }

      .output h3 {
        margin: 0 0 10px 0;
        font-family: inherit;
        font-size: 14px;
        color: #333;
      }

      .output pre {
        margin: 0;
        white-space: pre-wrap;
        word-break: break-all;
      }

      .results {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
      }

      @media (max-width: 768px) {
        .results {
          grid-template-columns: 1fr;
        }

        .controls {
          flex-direction: column;
          align-items: center;
        }
      }

      .loading {
        display: none;
        text-align: center;
        color: #666;
        margin: 20px 0;
      }

      .loading.show {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üñºÔ∏è Modern Screenshot HTML Export Demo</h1>
        <p>
          Test the new HTML export feature that preserves original image URLs
          instead of converting them to data URLs
        </p>
      </div>

      <div class="demo-section">
        <div id="content-to-capture" class="content-to-capture">
          <h2>Sample Content with Images</h2>
          <p>
            This content includes an external image with
            <code>crossorigin="anonymous"</code> that will be handled
            differently based on the export method:
          </p>
          <img
            src="https://proxima.creativeos.com/api/proxy-media?url=https%3A%2F%2Feditor.coscdn.net%2Fuploads%2F29aa727a-bd65-4fde-b2ff-f7b461d54632-image.png"
            alt="Beautiful landscape"
            class="sample-image"
            crossorigin="anonymous"
          />
          <p>üé® Beautiful content ready for capture!</p>
        </div>

        <div class="controls">
          <button id="btn-html-clean" class="btn">üìÑ Export Clean HTML</button>
          <button id="btn-html-embedded" class="btn secondary">
            üì¶ Export HTML (Embedded Images)
          </button>
          <button id="btn-image" class="btn secondary">
            üñºÔ∏è Export as Image
          </button>
        </div>

        <div class="loading" id="loading">‚è≥ Processing...</div>

        <div class="results" id="results"></div>
      </div>
    </div>

    <script type="module">
      import { domToImage, domToHtml } from "./src";

      const contentElement = document.getElementById("content-to-capture");
      const loadingElement = document.getElementById("loading");
      const resultsElement = document.getElementById("results");

      function showLoading() {
        loadingElement.classList.add("show");
        resultsElement.innerHTML = "";
      }

      function hideLoading() {
        loadingElement.classList.remove("show");
      }

      function displayResult(title, content, type = "text") {
        const resultDiv = document.createElement("div");
        resultDiv.className = "output";

        if (type === "image") {
          resultDiv.innerHTML = `
            <h3>${title}</h3>
            <div style="text-align: center;">
              ${content}
            </div>
          `;
        } else {
          resultDiv.innerHTML = `
            <h3>${title}</h3>
            <pre>${content}</pre>
          `;
        }

        resultsElement.appendChild(resultDiv);
      }

      function downloadFile(content, filename, mimeType = "text/html") {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      function downloadImage(imageElement, filename) {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = imageElement.naturalWidth || imageElement.width;
        canvas.height = imageElement.naturalHeight || imageElement.height;

        ctx.drawImage(imageElement, 0, 0);

        canvas.toBlob((blob) => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }, "image/png");
      }

      // Clean HTML Export (preserves original URLs)
      document
        .getElementById("btn-html-clean")
        .addEventListener("click", async () => {
          try {
            showLoading();
            console.log(
              "üßπ Exporting clean HTML (preserves original image URLs)..."
            );

            const htmlOutput = await domToHtml(contentElement, {
              debug: true,
              embedImages: false, // Explicitly disable image embedding
            });

            console.log("‚úÖ Clean HTML export completed");
            console.log("HTML length:", htmlOutput.length, "characters");

            displayResult(
              "Clean HTML Export (Original URLs Preserved)",
              htmlOutput
            );

            // Download the clean HTML file
            const timestamp = new Date()
              .toISOString()
              .slice(0, 19)
              .replace(/:/g, "-");
            downloadFile(
              htmlOutput,
              `clean-export-${timestamp}.html`,
              "text/html"
            );

            // Show size comparison
            const sizeInfo = `Size: ${htmlOutput.length} characters\nImages: Original URLs preserved (smaller output)\nCORS: crossorigin attributes removed for compatibility\n‚úÖ Downloaded as: clean-export-${timestamp}.html`;
            displayResult("Export Info", sizeInfo);
          } catch (error) {
            console.error("‚ùå Clean HTML export failed:", error);
            displayResult(
              "Error",
              `Failed to export clean HTML: ${error.message}`
            );
          } finally {
            hideLoading();
          }
        });

      // HTML Export with Embedded Images
      document
        .getElementById("btn-html-embedded")
        .addEventListener("click", async () => {
          try {
            showLoading();
            console.log("üì¶ Exporting HTML with embedded images...");

            const htmlOutput = await domToHtml(contentElement, {
              debug: true,
              embedImages: true, // Enable image embedding
            });

            console.log("‚úÖ Embedded HTML export completed");
            console.log("HTML length:", htmlOutput.length, "characters");

            displayResult("HTML Export (Embedded Images)", htmlOutput);

            // Download the embedded HTML file
            const timestamp = new Date()
              .toISOString()
              .slice(0, 19)
              .replace(/:/g, "-");
            downloadFile(
              htmlOutput,
              `embedded-export-${timestamp}.html`,
              "text/html"
            );

            // Show size comparison
            const sizeInfo = `Size: ${htmlOutput.length} characters\nImages: Converted to data URLs (larger output)\n‚úÖ Downloaded as: embedded-export-${timestamp}.html`;
            displayResult("Export Info", sizeInfo);
          } catch (error) {
            console.error("‚ùå Embedded HTML export failed:", error);
            displayResult(
              "Error",
              `Failed to export embedded HTML: ${error.message}`
            );
          } finally {
            hideLoading();
          }
        });

      // Image Export
      document
        .getElementById("btn-image")
        .addEventListener("click", async () => {
          try {
            showLoading();
            console.log("üñºÔ∏è Exporting as image...");

            const imageElement = await domToImage(contentElement, {
              debug: true,
              scale: 2,
            });

            console.log("‚úÖ Image export completed");

            // Download the image
            const timestamp = new Date()
              .toISOString()
              .slice(0, 19)
              .replace(/:/g, "-");
            downloadImage(imageElement, `screenshot-${timestamp}.png`);

            // Create a copy for display
            const displayImage = imageElement.cloneNode();
            displayImage.style.maxWidth = "100%";
            displayImage.style.height = "auto";
            displayImage.style.border = "1px solid #ddd";
            displayImage.style.borderRadius = "4px";

            displayResult("Image Export", displayImage.outerHTML, "image");
            displayResult(
              "Export Info",
              `‚úÖ Downloaded as: screenshot-${timestamp}.png`
            );
          } catch (error) {
            console.error("‚ùå Image export failed:", error);
            displayResult("Error", `Failed to export image: ${error.message}`);
          } finally {
            hideLoading();
          }
        });

      // Initial log
      console.log("üöÄ Modern Screenshot Demo Ready!");
      console.log("Click the buttons above to test different export methods.");
    </script>
  </body>
</html>
